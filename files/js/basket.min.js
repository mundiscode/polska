var Basket=function(){var f=this;var a="koszyk";this.init=function(){var g=50;$(".js-basket-add").click(function(){});$("body").on("click",".js-basket-plus",function(){var h=$(this).attr("data-product-uid");var j=new Number($("input[name='quantity["+h+"]']").val());j++;if(j>g){j=g}if(j<=0){j=1}$("input[name='quantity["+h+"]']").val(j);if(new Number($("input[name='quantity["+h+"]']").attr("data-product-q"))==j){$(this).parents(".numberbox-wrapper").removeClass("is-active");$(this).parents(".numberbox__button").hide()}else{$(this).parents(".numberbox-wrapper").addClass("is-active");$(this).parents(".numberbox__button").show()}});$("body").on("click",".js-basket-minus",function(){var h=$(this).attr("data-product-uid");var j=new Number($("input[name='quantity["+h+"]']").val());j--;if(j>g){j=g}if(j<=0){j=1}$("input[name='quantity["+h+"]']").val(j);if(new Number($("input[name='quantity["+h+"]']").attr("data-product-q"))==j){$(this).parents(".numberbox-wrapper").removeClass("is-active");$(this).parents(".numberbox__button").hide()}else{$(this).parents(".numberbox-wrapper").addClass("is-active");$(this).parents(".numberbox__button").show()}});$("body").on("click",".js-basket-update",function(){var h=$(this).attr("data-product-uid");var j=new Number($("input[name='quantity["+h+"]']").val());$.ajax({url:"/koszyk/update",data:{uid:h,quantity:j},dataType:"json",method:"post",beforeSend:function(){$(".page-loader-layer").show()}}).done(function(l,n,m){var k=m.getResponseHeader("content-type")||"";if(k.indexOf("application/json")>-1){window.location.href="/koszyk"}}).fail(function(k,l){window.location.href="/koszyk"})});$("body").on("click",".js-basket-add-to-order",function(){var j=$(this).attr("data-product-uid");var k=$(this).attr("value");var h=$(this);$.ajax({url:"/koszyk/update-add-to-order",data:{uid:j,value:k},dataType:"json",method:"post",beforeSend:function(l){$(".page-loader-layer").show()}}).done(function(m,o,n){var l=n.getResponseHeader("content-type")||"";if(l.indexOf("application/json")>-1){if(h.data("redirect")=="review"){window.location.href="/koszyk/podsumowanie-i-weryfikacja"}else{window.location.href="/koszyk"}}}).fail(function(l,m){if(h.data("redirect")=="review"){window.location.href="/koszyk/podsumowanie-i-weryfikacja"}else{window.location.href="/koszyk"}})});$("body").on("click",".js-basket-del",function(){var h=$(this);$.ajax({url:"/koszyk/delete",beforeSend:function(j){$(".page-loader-layer").show()},data:{uid:$(this).attr("data-product-uid")},dataType:"json",method:"post"}).done(function(k,m,l){var j=l.getResponseHeader("content-type")||"";if(j.indexOf("application/json")>-1){if(h.data("redirect")=="review"){window.location.href="/koszyk/podsumowanie-i-weryfikacja"}else{window.location.href="/koszyk"}}}).fail(function(j,k){if(h.data("redirect")=="review"){window.location.href="/koszyk/podsumowanie-i-weryfikacja"}else{window.location.href="/koszyk"}})});$(".js-basket_delivery_types").off("click",".panel__option").on("click",".panel__option",function(k){k.preventDefault();var j=$(this).parent();if($(this).hasClass("js-discount-dialog")){var l=j.find(".deliveryTypeField");var h=new Dialog("#basketInactiveDiscounts-"+l.val());h.show();e(j)}else{b(j)}});$(".js-basket_delivery_types").on("click",".js-dialog-inactive-discounts-confirm",function(j){var k=$(this).data("delivery-type-id");if(!k>0){return false}var h=new Dialog("#basketInactiveDiscounts-"+k);h.hide();b($("#delivery_panel_"+k))});$(".js-basket_delivery_types").on("click",".js-dialog-inactive-discounts-discard",function(j){var k=$(this).data("delivery-type-id");if(!k>0){return false}var h=new Dialog("#basketInactiveDiscounts-"+k);h.hide();e($("#delivery_panel_"+k))});$(".js-basket_delivery_types").on("click",".js-button-submit",function(l){l.preventDefault();var k=$(this).parents("form");var j=k.find('input[name="delivery_type_id"]:checked');if(!j.length){k.submit();return true}if(!j.parents(".panel__option").hasClass("js-basket-redirect")){k.submit();return true}l.preventDefault();d(".modal-dialog .tooltip-container");var h=new Dialog("#basketRedirect");h.show();return false});$(".js-basket_delivery_types").on("click",".js-dialog-button-submit",function(k){k.preventDefault();var j=$(this).parents("form");var h=j.find('input[type="checkbox"][name="redirection_consent[]"]');var l=true;$.each(h,function(o,n){var m=$(n);if(!m.is(":checked")){if(!m.hasClass("input-error")&&l==true&&m.data("default-error")){c(m.parents(".form-group"),m.data("default-error"))}l=false}});if(l){j.submit();return true}return false});$(".js-basket_delivery_types").on("click",".js-dialog-button-pharmacy-submit",function(l){l.preventDefault();var k=$(this).parents("form");var h=new Dialog("#basketRedirect");h.hide();$(".js-basket_delivery_types .is-show-content").removeClass("is-show-content");k.find(".deliveryTypeField").removeProp("checked").ezMark();var j=k.find('input[type="radio"][name="delivery_type_id"][value="1"]');if(j.length>0){j.trigger("click");if(!j.parents(".panel__option").hasClass("js-discount-dialog")){k.submit();return false}}return false});$(".js-basket_delivery_types").on("click",'input[type="checkbox"][name="redirection_consent[]"]',function(k){var j=$(this).parents("form");var h=j.find('input[type="checkbox"][name="redirection_consent[]"]');var l=true;$.each(h,function(o,n){var m=$(n);if(!m.is(":checked")){l=false}});if(l){d(".modal-dialog .tooltip-container")}return true})};this.replacementSearch=function(){$("body").delegate(".js-basket-replacement-search","click",function(){var k=$(this).attr("data-product-id");var l=$(this).attr("data-product-quantity");var h=$(this).attr("data-product-refund");var g=new Dialog("#dialog-ajax");var j=$(this).closest(".basket__product").find(".productCartContainer").clone();$.ajax({type:"POST",url:"/koszyk/sprawdz-zamienniki",data:{id:k,quantity:l,refund:h},dataType:"json",beforeSend:function(){g.content("");g.show();g.loaderShow()},success:function(m){if(m.status=="ok"&&m.content.length>0){g.loaderHide();g.content(m.content);$("#shoppingCartReplacaments select").select2Init();$("#produktZKoszyka").find(".nazwa").html("");$("#produktZKoszyka").find(".cena").html("");$("#produktZKoszyka").find(".dostepne").html("");$("#produktZKoszyka").find(".nazwa").html(j.find("figure").html()+j.find(".basket__product-description").data("product-name-and-info"));$("#produktZKoszyka").find(".cena").html(j.find(".basket__product-price").data("product-price-value-formatted")+" zÅ‚");$("#produktZKoszyka").find(".dostepne").html(j.find(".js-basket__product-qty-available").text()+" / "+j.find(".js-basket__product-qty-ordered").text())}}})})};this.checkAvailability=function(){$.ajax({type:"POST",url:"/koszyk/weryfikacja-stanow",data:"",dataType:"json",beforeSend:function(){$(".avprogress").show()},success:function(g){if(g.status=="ok"){$("#shoppingCartVerification").html(g.content);$(".avcompleted").removeClass("hidden")}else{if(g.status=="error"||typeof g==="undefined"){$(".averror").removeClass("hidden")}}$(".avprogress").hide()},error:function(){$(".avprogress").hide();$(".averror").removeClass("hidden")}});return false};this.shipmentAddress=function(g){$.ajax({type:"POST",url:"/koszyk/zmien-adres-dostawy",data:{delivery_address_id:g},dataType:"json",beforeSend:function(){},success:function(h){if(h.status=="ok"){$("#js-basket-shipment-delivery-address-container").html(h.content);$("select.js-shipment-address").select2();$('select[name="country_code"]').select2();$('input[type="checkbox"]').ezMark()}else{$("#systemError").show()}},error:function(){}})};this.invoiceData=function(g,h){$.ajax({type:"POST",url:"/koszyk/zmien-dane-do-faktury",data:{inv_invoice_type:g,inv_invoice_id:h},dataType:"json",beforeSend:function(){},success:function(j){if(j.status=="ok"){$("#js-basket-shipment-invoice-data-container").html(j.content);$("select.js-invoice-data").select2()}else{$("#systemError").show()}},error:function(){}})};var c=function(h,g){$(h).addClass("input-error").closest(".form-group").addClass("has-error");$(h).tooltip({title:g,trigger:"manual"});h.tooltip("show")};var d=function(g){$(g).tooltip("destroy");setTimeout(function(){$(g).removeAttr("data-original-title").removeAttr("title").removeClass("input-error").closest(".form-group").removeClass("has-error")},250)};var b=function(g){var j=g.find(".deliveryTypeField");if(j.attr("disabled")==="disabled"){return false}if(g.hasClass("is-show-content")===false){$.ajax({type:"POST",url:"/koszyk/koszt-dostawy",data:{delivery_type_id:j.attr("id")},dataType:"json",beforeSend:function(){$(".page-loader-layer").show()},success:function(l){$(".page-loader-layer").hide();if(typeof l.status==="undefined"||typeof l.html==="undefined"){return false}if(l.status=="error"){e(g)}if(l.html!=""){for(var o in l.html){var k=$('[data-container="'+o+'"]');var n=l.html[o];k.html(n)}$('input[type="radio"]').ezMark();$('input[type="checkbox"]').ezMark();if($("#delivery_panel_"+j.attr("id")+" .panel__option").hasClass("js-basket-redirect")===true){d(".modal-dialog .tooltip-container");var m=new Dialog("#basketRedirect");m.show()}return true}},error:function(){}})}else{if(g.find(".panel__option").hasClass("js-basket-redirect")===true){d(".modal-dialog .tooltip-container");var h=new Dialog("#basketRedirect");h.show()}}if(g.hasClass("is-show-content")===false){$(".js-basket_delivery_types .deliveryTypeField").removeProp("checked").ezMark();j.prop("checked",true);j.trigger("change");j.ezMark();$(".js-basket_delivery_types .is-show-content").removeClass("is-show-content");g.addClass("is-show-content")}};var e=function(g){var h=g.find(".deliveryTypeField");if(g.hasClass("is-show-content")){g.removeClass("is-show-content")}h.removeProp("checked").ezMark()}};$(document).ready(function(){$(".mCustomScrollbars").mCustomScrollbar({updateOnSelectorChange:true});$(".shoppingCartPharmacy").mCustomScrollbar("update");var g=new Basket();g.init();g.replacementSearch();if($("#js-basket-verify-stock-trigger").length==1){g.checkAvailability()}if($("#js-basket-shipment-container").length==1){$(document).on("change",".js-shipment-address",function(){g.shipmentAddress($(this).val())});$(document).on("click",".js-shipment-add-name-trigger",function(m){if($('input[type="checkbox"][name="add_new_address"]').is(":checked")){$("#js-shipment-add-name-container").show()}else{$("#js-shipment-add-name-container").hide()}})}if($("#js-basket-shipment-invoice-data-container").length==1){$(document).on("change",".js-invoice-data",function(){g.invoiceData($(this).val())});$(document).on("change",".js-invoice-address",function(){g.invoiceData($(".js-invoice-data option:selected").val(),$(this).val())})}if($("#js-basket-shipment-receipt-point-container").length==1){var a=new DozMap();var d=function(){if(a.initialized==true){return}var o=$("#js-delivery-type").val();var n="inpost-basket";if(o=="DHL_PARCEL"){n="dhl-parcel-basket"}var m={config:{container:"js-search-pharmacy-map",type:n,markerCluster:true}};a.init(m);$.ajax({url:"/koszyk/mapa-punkty-odbioru",data:{type:o},dataType:"json",method:"post"}).done(function(p,r,q){a.loadPoints(p);a.centerCurrentPosition()}).fail(function(p,q){})};$(document).on("click","button.chooseInpostMap",function(m){var n=$(this).attr("data-inpost-id");$("#js-selected-delivery-receipt-point-id").val(n);$("#js-map-receipt-point-container").hide();$("#js-chosen-receipt-point-container").show();$("#js-selected-receipt-point-info").html($(this).attr("data-inpost-description"));$("html, body").animate({scrollTop:0},"slow")});$(document).on("click","#js-change-receipt-point-trigger",function(m){$("#js-map-receipt-point-container").show();$("#js-chosen-receipt-point-container").hide();$("html, body").animate({scrollTop:0},"slow")});$(document).on("click",".js-search-phrase-trigger-pharmacy-map",function(n){var o=$(".js-search-phrase-pharmacy-map");var m=o.val();if(m.length>0){a.searchOnMap(m)}});$(document).on("keyup",".js-search-phrase-pharmacy-map",function(m){if(m.keyCode===13){$(".js-search-phrase-trigger-pharmacy-map").click()}});$(document).on("keydown",".js-search-phrase-pharmacy-map",function(m){if(m.keyCode===13){return false}});d()}if($("#js-delivery-address-pharmacy-trigger").length==1){var a=new DozMap();var e=function(){if(a.initialized==true){return}var m={config:{container:"js-search-pharmacy-map",type:"pharmacy-basket",markerCluster:true}};a.init(m);$.ajax({url:"/koszyk/mapa-aptek",data:{},dataType:"json",method:"post"}).done(function(o,q,p){a.loadPoints(o)}).fail(function(o,p){});var n=function(){$("#findPharmacyContainer .loader-layer").show();var s=$("select.js-geo-voivodeship");var o=s.val();var r=$("select.js-geo-city");if($(this).hasClass("js-geo-voivodeship")){r.val("")}var t=r.val();var p=$("div.shoppingCartPharmacy");var q=$("#shoppingCartPharmacyMobile");$.ajax({url:"/koszyk/miasta-apteki",data:{voivodeship_id:o,city_id:t},dataType:"json",method:"post"}).done(function(u,w,v){c(u,t,r,p,q);k();$("#findPharmacyContainer .loader-layer").hide()}).fail(function(u,v){$("#findPharmacyContainer .loader-layer").hide()})};$("select.js-geo-voivodeship").select2();$("select.js-geo-city").select2();$(document).on("change",".js-geo-voivodeship",n);$(document).on("change",".js-geo-city",n)};var f=function(){var m=$(".label__biger").first();if($("#chosenPharmacyContainer").is(":visible")){$("#chosenPharmacyContainer").addClass("hidden");$("#findPharmacyContainer").removeClass("hidden");$("#favouritePharmacyContainer").removeClass("hidden")}else{$("#chosenPharmacyContainer").removeClass("hidden");$("#findPharmacyContainer").addClass("hidden");$("#favouritePharmacyContainer").addClass("hidden");h()}$('input[type="radio"][name="favourite_receipt_points"][value="'+$("#selectedPharmacyId").val()+'"]:first').prop("checked","checked");$("#shoppingCartPharmacyMobile").val($("#selectedPharmacyId").val());$("#shoppingCartPharmacyMobile").select2();e();$('input[type="radio"]').ezMark()};function j(m){a.showPoint(15,m)}var l=function(p,n,m){var o=$(p.target);if(o.hasClass("choosePharmacyMap")){$('input[type="radio"][name="favourite_receipt_points"]').removeProp("checked");$('input[type="radio"][name="favourite_receipt_points"]').ezMark();$("#shoppingCartPharmacyMobile").val("");$("#shoppingCartPharmacyMobile").select2()}else{if(a.infoWindow!==undefined){a.infoWindow.close(a.currentConfig.instance)}}if(typeof n==="undefined"){n=$(this).data("pharmacy-id")}if(typeof m==="undefined"){var m=$(this).data("pharmacy-title")}if(n==$("#selectedPharmacyId").val()){$("#js-change-pharmacy-trigger").click();return}$("#selectedPharmacyInfo").text(m);$("#selectedPharmacyId").val(n);$("#js-change-pharmacy-trigger").click();$("html, body").animate({scrollTop:0},"slow")};var k=function(){if($(".js-geo-voivodeship :selected").val()!=""){$("#findPharmacyContainer .pharmacyListWrapper").show()}};var h=function(){if($('#pharmaciesListContainer input[type="radio"][value="'+$("#selectedPharmacyId").val()+'"]').length>0){$("#js-remember-pharmacy-container").hide();$('#js-remember-pharmacy-container input[type="checkbox"][name="save_pharmacy_as_favourite"]').removeProp("checked").ezMark()}else{$('#js-remember-pharmacy-container input[type="checkbox"][name="save_pharmacy_as_favourite"]').prop("checked",true).ezMark();$("#js-remember-pharmacy-container").show()}};var c=function(o,s,t,m,u){if(typeof o.cities!="undefined"){t.empty();t.append($("<option>",{value:"",text:"Wybierz miasto"}));for(i in o.cities){t.append($("<option>",{value:o.cities[i].id,text:o.cities[i].name}))}if(s){t.val(s)}t.select2()}if(typeof o.pharmacies!="undefined"){m.empty();u.empty();for(i in o.pharmacies){var r=[o.pharmacies[i].postcode.slice(0,2),"-",o.pharmacies[i].postcode.slice(2)].join("");var p=o.pharmacies[i].city+", ul. "+o.pharmacies[i].street;var n=o.pharmacies[i].name+", "+r+" "+o.pharmacies[i].city+", ul. "+o.pharmacies[i].street;var q="";if(o.pharmacies[i].gps_lat!=null&&o.pharmacies[i].gps_lng!=null){var q='<span class="fa fa-map-marker color-primary js-map-pharmacy-zoom pull-right" data-pharmacy-id="'+o.pharmacies[i].id+'"></span>'}m.append($('<div class="radio check__item"><label><input type="radio" value="'+o.pharmacies[i].id+'" name="favourite_receipt_points"  data-pharmacy-id="'+o.pharmacies[i].id+'" data-pharmacy-title="'+n+'">'+p+q+" </label>"));u.append($('<option  data-pharmacy-id="'+o.pharmacies[i].id+'" data-pharmacy-title="'+n+'">').val(o.pharmacies[i].id).text(p))}$('input[type="radio"]').ezMark();$(".shoppingCartPharmacy").mCustomScrollbar("update")}k()};$(document).on("click","#js-change-pharmacy-trigger",f);$(document).on("click",'input[name="favourite_receipt_points"]',l);$(document).on("click","button.choosePharmacyMap",l);$(document).on("change","select.shoppingCartPharmacyMobile",function(m){l(m,$(this).find("option:selected").data("pharmacy-id"),$(this).find("option:selected").data("pharmacy-title"))});$(document).on("click",".js-map-pharmacy-zoom",function(m){m.preventDefault();j($(this).data("pharmacy-id"))});$(document).on("click",".js-search-phrase-trigger-pharmacy-map",function(n){var o=$(".js-search-phrase-pharmacy-map");var m=o.val();if(m.length>0){a.searchOnMap(m)}});$(document).on("keyup",".js-search-phrase-pharmacy-map",function(m){if(m.keyCode===13){$(".js-search-phrase-trigger-pharmacy-map").click()}});$(document).on("keydown",".js-search-phrase-pharmacy-map",function(m){if(m.keyCode===13){return false}});$(".input-error").tooltip("show");k();if($("#findPharmacyContainer").is(":visible")&&a.initialized==false){e()}h();c(JSON.parse($("#js-pharmacies-voivodeship-city-list").val()||{}),$("#js-selected-city-id").val(),$("select.js-geo-city"),$("div.shoppingCartPharmacy"),$("#shoppingCartPharmacyMobile"))}var b=function(){var r=$(".basket__sum-item--total");if(r.length>0){var q=100;var p=r.offset().top+q;var m=r.offset().top+r.outerHeight();var n=$(window).scrollTop()+$(window).innerHeight();var o=$(window).scrollTop();if((n>p)&&(o<m)){$(".basket__buttons").removeClass("basket__buttons--sticky")}else{$(".basket__buttons").addClass("basket__buttons--sticky")}}};b();$(window).scroll(function(){b()})});