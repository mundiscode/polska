$(document).ready(function(){$("body").delegate(".searchFacets","change",function(){if(parseFloat($("#priceFrom").val())>parseFloat($("#priceTo").val())){var b=new FormCheck("#sidebarForm");b.error("priceTo","Warto�� od nie mo�e by� wi�ksza ni� do");return}if(parseFloat($("#priceFrom").val())<0){var b=new FormCheck("#sidebarForm");b.error("priceFrom","Warto�� poza zakresem");return}searchFilter()});$("body").delegate("#searchFilterReset","click",function(){resetSearchFilter()});$("body").delegate("#menu_cat_more","click",function(){$("#menu_cat_more").hide();$("#menu_cat_less").removeClass("hidden");$("#menu_cat_less").show();$(".cat-toggle-sub").removeClass("hidden");$(".cat-toggle-sub").slideDown("slow")});$("body").delegate("#menu_cat_less","click",function(){$("#menu_cat_more").show();$("#menu_cat_less").hide();$(".cat-toggle-sub").fadeOut()});if($(".category .categoryDescription").length>0){var a=$(".category .categoryDescription").prop("scrollHeight");if(a>50){$(".category .collapse__categoryDescription").addClass("show");$(".category .categoryDescription").addClass("categoryDescriptionButton")}$("body").delegate(".category .btn-categoryDescription-show","click",function(b){b.preventDefault();if(!$(".category .categoryDescription").hasClass("showFullDescription")){$(".category .categoryDescription").addClass("showFullDescription")}$(this).hide();$(".category .btn-categoryDescription-hide").show()});$("body").delegate(".category .btn-categoryDescription-hide","click",function(b){b.preventDefault();if($(".category .categoryDescription").hasClass("showFullDescription")){$(".category .categoryDescription").removeClass("showFullDescription")}$(this).hide();$(".category .btn-categoryDescription-show").show()})}});function resetSearchFilter(){var a={search:$("#searchPhrase").val(),filterType:$("#filterType").val()};if($("#filterType").val()==="categories"){a={catId:$("#searchCategoryId").val(),filterType:$("#filterType").val()}}else{if($("#filterType").val()==="promotion"){a={filterType:$("#filterType").val()}}else{if($("#filterType").val()==="recommend"){a={filterType:$("#filterType").val()}}}}return searchFilterData(a)}function searchFilter(){var c={search:$("#autocompleteSearch").val(),catId:$("#searchCategoryId").val(),filterType:$("#filterType").val(),priceFrom:$("#priceFrom").val(),priceTo:$("#priceTo").val(),producer:$("#searchProducer").val(),filter:{bestseller:$('input[name="filter[bestseller]"]:checked').length,newoffer:$('input[name="filter[newoffer]"]:checked').length,recommended:$('input[name="filter[recommended]"]:checked').length,promotional:$('input[name="filter[promotional]"]:checked').length,unavailable:$('input[name="filter[unavailable]"]:checked').length},top:$("#searchTop").val(),sort:$("#searchSort").val()};var a={};a.producer=c.producer;$("#searchSort option:selected").each(function(){a.sort=$(this).text()});var b=[];if(c.filter.newoffer==1&&$('input[name="filter[newoffer]"]').attr("data-filter-label")!=""){b.push($('input[name="filter[newoffer]"]').attr("data-filter-label"))}if(c.filter.promotional==1&&$('input[name="filter[promotional]"]').attr("data-filter-label")!=""){b.push($('input[name="filter[promotional]"]').attr("data-filter-label"))}if(c.filter.bestseller==1&&$('input[name="filter[bestseller]"]').attr("data-filter-label")!=""){b.push($('input[name="filter[bestseller]"]').attr("data-filter-label"))}if(c.filter.recommended==1&&$('input[name="filter[recommended]"]').attr("data-filter-label")!=""){b.push($('input[name="filter[recommended]"]').attr("data-filter-label"))}if(c.filter.unavailable==1&&$('input[name="filter[unavailable]"]').attr("data-filter-label")!=""){b.push($('input[name="filter[unavailable]"]').attr("data-filter-label"))}a.filter=b.join(",");var d=new GtmEvent();d.listFilter(a);return searchFilterData(c)}function searchFilterData(a){$.ajax({url:"/ajaxapteka/f",type:"POST",dataType:"json",data:a,beforeSend:function(){$(".page-loader-layer").show()},success:function(b){$("#categoriesContainer").html(b.categories);$("#productsContainer").html(b.products);$("#pagingContainer").html(b.paging);$("#itemsContainer").html(b.items);$("#searchFilters").html(b.filters);$("#facetsContainer").html(b.facets);$("#filterCountContainer").html(b.items);$(".select-checkbox").ezMark();$(".select-search").select2("destroy");$(".select-search").select2({minimumResultsForSearch:Infinity,containerCssClass:"tpx2-select2-container",dropdownCssClass:"tpx2-select2-drop"});$(".page-loader-layer").hide();window.history.pushState("","Title",b.url);initProductListTypeChanger()}});return false};